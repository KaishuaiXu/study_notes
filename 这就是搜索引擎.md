# 搜索引擎及其技术架构

1. 搜索引擎的三个目标

   - 更全：网络爬虫
   - 更快：索引、缓存、分布式云存储
   - 更准：排序、链接分析、用户研究

2. 搜索引擎的3个核心问题

   - **相关性**：内容与用户查询关键词的相关性

     目前的基本思想还是基于关键词的匹配，未来应该$\color{red}{让机器真正理解信息的含义}$！！！

   - **可信赖性**：返回信息的置信度

     信息的可信性。

   - 用户需求**：获知用户查询词背后的真实需求

     $\color{red}{不同用户或不同应用场景下，相同的查询词可能代表不同的信息需求。。}$

3. 搜索引擎技术发展历史

   <img src="/Users/caiyinqiong/Library/Application Support/typora-user-images/image-20191103004155614.png" alt="image-20191103004155614" style="zoom:25%;" />

   - 基于分类目录

     > 核心技术：通过人类收集整理，把高质量的网页分类别罗列。需要用户根据分级目录来查找高质量的网站。
     >
     > （重点关注**可信赖性**，没有考虑用户需求和相关性）

   - 基于文本检索

     > 核心技术：计算用户查询词与网页文本内容的相关程度。
     >
     > （主要解决了**相关性**，没有考虑真正的用户需求，也没有处理信息的可信度）

   - 基于链接分析

     > 核心技术：充分利用网页之间的链接关系，并深入挖掘和利用网页链接所代表的含义。通过结合网页流行度和内容相似性来改善搜索质量。
     >
     > （主要解决了可信赖性和相关性，但没有关注用户需求）

   - 基于用户为中心

     > 核心技术：以理解用户需求为核心。也可以借助查询时间、查询地点、查询历史、点击记录等信息。
     >
     > （同时考虑3个核心问题）

4. 搜索引擎架构

   <img src="/Users/caiyinqiong/Library/Application Support/typora-user-images/image-20191103004738105.png" alt="image-20191103004738105" style="zoom:35%;" />



# 网络爬虫

1. 通用爬虫框架

   <img src="/Users/caiyinqiong/Library/Application Support/typora-user-images/image-20191103210054234.png" alt="image-20191103210054234" style="zoom:50%;" />

   - 批量型爬虫
   - 增量型爬虫
   - 垂直型爬虫

2. 重点技术

   - **抓取策略**

     核心：网页重要性评价标准。

     - 宽度优先遍历：将新下载网页包含的链接直接追加到待抓取URL队列末尾

       这种方式效果好的原因可能在于，在某种程度上入链数可以体现网页重要度，而这种方式隐含了网页入链数越多，越容易被先抓取。

     - 非完全pagerank策略：对于已经下载和待抓取URL队列中的URL一起计算pagerank，然后将待抓取URL中的网页按照pagerank得分排序，形成接下来的抓取顺序。

       为了防止每次计算pagerank时间代价较高，一般会每新下载一定量的网页，才会计算一遍非完全的pagerank得分。同时，对于新抽取出来又没有pagerank值的网页，将该网页的所有入链传导的pagerank值汇总，作为它的临时pagerank值。

       （该策略的性能不太确定是否好于宽度优先遍历）

     - OPIC（Online Page Importance Computation）策略：在算法开始之前，每个页面都赋予相同的cash，每下载一个页面，就将该页面的cash平均分配给该页面中包含的链接页面。对于待抓取URL队列中的网页，则根据各自的cash进行排序。

       （该算法速度快于pagerank，适合实时计算。。而且效果好于宽度优先遍历。。）

     - 大站优先策略：以网站为单位来衡量网页重要性，对于待抓取URL队列中的网页，根据所属网站进行归类，哪个网站待下载的页面多，则优先下载该网站的链接。

       （效果好于宽度优先遍历）

   - **网页更新策略**

     动机：本地下载的网页可以看做互联网页面的“镜像”，对于已抓取过的网页，爬虫还要负责保持其内容和互联网页面内容的同步，因此要不断进行网页更新。

     - 历史参考策略

       假设：过去频繁更新的网页，将来也会频繁更新，可以通过对历史更新情况进行建模，来预估某个网页何时更新。

       方法：利用泊松过程对网页的变化进行建模。

     - 用户体验策略

       假设：判断一个网页何时更新为好，取决于这个网页的内容变化所带来的的搜索质量的变化。

       方法：保存网页的多个历史版本，并根据过去每次内容变化对搜索质量的影响得出一个平均值，以次作为是否需要重抓该网页的参考依据。

     - 聚类抽样策略

       假设：网页具有一些属性，根据这些属性可以预测其更新周期，具有相似属性的网页的更新周期也是相似的。

       方法：根据网页的属性特征（静态特征、动态特征）将网页聚类成不同的类别，从每个类别中抽取一部分最具有代表性的网页，对他们计算更新周期，该类别中所有网页都使用该更新周期。

       特点：① 不像前两种更新策略一样，聚类抽样策略不需要依赖所有网页的历史更新信息，只需要保存每个类别中代表网页的更新信息即可，减少系统的负担。② 效果好于前两种策略。③ 对海量网页聚类的难度较高。

   - **暗网抓取**

     暗网：目前搜索引擎爬虫按照常规方式很难抓取到的互联网页面。

     为了能够爬取暗网的数据，就需要开发专门的<u>暗网爬虫</u>。

     主要技术挑战：

     - 查询组合问题：关键是用ISIT算法找到富含信息的查询模板。

     - 文本框填写问题：人工启发 + 递归迭代

   - **分布式爬虫**

     基本架构：

     - 分布式数据中心：负责抓取本地域周边的互联网网页。
     - 分布式抓取服务器：同一数据中心的不同抓取服务器的分工协作方式一般有两种。
       - 主从式分布爬虫
       - 对等式分布爬虫：哈希方法
     - 分布式爬虫程序

     

# 索引

1. 倒排索引的基本概念

   索引是实现单词-文档矩阵的具体数据结构。

   - 单词词典（存在内存中）：哈希链表结构/树形结构

   - 倒排列表（存在磁盘中）：倒排索引项 = DocID + TF + pos

2. 索引的建立

   - 两遍文档遍历法

     >特点：完全在内存中完成索引的创建，对内存需求大；两遍扫描速度慢。
     >
     >方法：
     >
     >- 第一遍遍历是收集一些统计信息，比如一共有多少单词，每个单词的总词频，以便知晓需要在内存中开辟多大的连续存储空间，以及每个单词的倒排列表在内存中的位置。
     >
     >- 第二遍遍历是为每个单词填充其倒排列表。

   - 排序法

     > 特点：在索引建立时，始终在内存中分配固定的大小来存放词典和索引的中间结果。但随着索引的建立过程，词典会越来越大，导致给索引的中间结果留的空间会逐渐减小。
     >
     > 方法：
     >
     > - 依次解析各个文档，不断更新词典，同时为该文档中的每个词建立（词ID，文档ID，词频）三元组。
     > - 当分配的固定内存占满时，对内存中的所有三元组排序，并将三元组写到磁盘（注意，词典一直在内存中未被写出）。
     > - 将所有文档解析完成后，进行合并过程，即把所有写出到磁盘的中间结果进行合并。为每个中间结果分配一定的内存缓冲区，依次合并每个单词的三元组，形成其倒排列表，并清除该单词的缓冲，再进行下一个单词的合并。

   - 归并法

     > 特点：解决了排序法的缺点。
     >
     > 方法：
     >
     > - 在内存中建立一个完整的索引结构，当分配的内存占满时，将整个内存中的倒排索引写出到磁盘文件。
     > - 合并时，对每个单词的倒排列表进行合并，形成该单词最终的倒排列表。。并在合并的过程中，完成词典的构建。

3. 动态索引

   搜索引擎的文档集合是动态变化的，用动态索引实现实时性要求。

   动态索引 = 倒排索引 + 临时索引 + 已删除文档列表

<img src="/Users/caiyinqiong/Library/Application Support/typora-user-images/image-20191109174440544.png" alt="image-20191109174440544" style="zoom:50%;" />

<img src="/Users/caiyinqiong/Library/Application Support/typora-user-images/image-20191109174540724.png" alt="image-20191109174540724" style="zoom:50%;" />

<img src="/Users/caiyinqiong/Library/Application Support/typora-user-images/image-20191109174604240.png" alt="image-20191109174604240" style="zoom:50%;" />

4. 索引更新

   目的：当分配的内存用完时，将临时索引的内容更新到磁盘索引。

   - 完全重建策略

     需要时间较长，适合小文档集合。但目前主要的商业搜索引擎一般采用该方式。

   - 再合并策略

     效率较高，但缺点在于即使对于某些未发生变化的单词的老索引，也要进行读写到新索引，会浪费时间。

   - 原地更新策略

     出发点是为了解决再合并索引的缺点，但数据表明，其效率低于再合并策略。

   - 混合策略

     出发点是结合不同策略的长处。

     一般做法：将单词分为长倒排列表单词和短倒排列表单词。长倒排列表单词使用原地更新策略，短倒排列表单词使用再合并策略。

5. 查询处理

   - 一次一文档
   - 一次一单词
   - 跳跃指针：将一个倒排列表切分成若干个固定大小的数据块。。可以提高效率。

6. 多字段索引

   - 多索引方式：为每个字段单独建一个索引。（效率会比较低）

   - 倒排列表方式：在倒排列表中每个文档索引项信息的末尾追加字段信息。

   - 扩展列表方式：为每个字段建立一个列表，记录每个字段的位置信息。（应用得比较多）

     <img src="/Users/caiyinqiong/Library/Application Support/typora-user-images/image-20191110122918592.png" alt="image-20191110122918592" style="zoom:50%;" />

7. 短语查询

   - 位置信息索引：（存储和计算代价高，只适合处理常规的计算代价小的短语查询）

   - 双词索引：在内存中包含两个字典，分别是“首词”词典和“下词”词典，首词词典有指针指向下词词典的某个位置，下词词典的指针指向包含这个短语的倒排列表。（导致索引增加，实际使用时仅对计算代价较高的短语建立双词索引）

   - 短语索引：在词典中直接加入多词短语并维护多词短语的倒排列表。（不可能对所有短语建立索引，实际的做法是挖掘出热门短语/高频度短语并建立其索引）

   - 混合方法

     接收到用户查询后，先在短语索引中查找，若找不到，再在双词索引中查找，若找不到，再用位置信息索引。

8. 分布式索引

   每台机器维护整个索引的一部分，由多台机器协作完成索引的建立和对查询的响应。

   - 按文档划分：将整个文档集合切割成若干子集合，每台机器负责对某个文档子集合建立索引，并响应请求。
   - 按单词划分：对单词词典进行划分，每个索引服务器负责词典中部分单词的倒排列表的建立和维护。（这种方式只适合一次一单词的查询处理）

   总体而言，从扩展性、负载均衡、容错性、对查询处理方式的支持等方面，按文档划分都好于按单词划分。



# 检索与排序

1. 基本概念

   - 词典压缩
   - 倒排列表压缩
     - 无损压缩
     - 有损压缩

2. 词典压缩

3. **倒排列表压缩**

   - 评价压缩算法的指标

     - 压缩率

     - 压缩速度
     - 解压速度

   - 基本编码方式

     - 一元编码
     - 二进制编码

   - 压缩算法

     - 无损压缩
       - Elias Gamma 与 Elias Delta

         Elias Delta 对于大数值的压缩效果优于 Elias Gamma

       - Golomb 与 Rice

       - 变长字节算法

       - SimpleX系列算法（Simple9）

       - PForDelta 算法

         解压速度是现有压缩算法中最快的。

       - 文档编号重排序

     - 有损压缩

       - 静态索引裁剪（以文档为单位、以单词为单位）



# 链接分析



# 云存储与云计算



# 用户查询意图分析





